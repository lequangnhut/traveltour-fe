<div class="container">
    <div class="header-control mb-4">
        <div class="header-control-center">
            <div class="d-flex justify-content-between align-items-center row ">
                <div class="col-xl-12 mt-3">
                    <h3 class="color-green fw-bold text-uppercase">Danh sách khách đặt tour</h3>
                </div>
            </div>
        </div>
    </div>

    <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
        <li class="nav-item" role="presentation">
            <a class="nav-link active" id="pills-true-tab" data-bs-toggle="pill" href="#pills-true"
               role="tab" aria-controls="pills-true" aria-selected="true" ng-class="{active: currentTab === 'pending'}"
               ng-click="changeTab('pending', 0)">Chờ thanh
                toán</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="pills-false-tab" data-bs-toggle="pill" href="#pills-false" role="tab"
               aria-controls="pills-false" aria-selected="false" ng-class="{active: currentTab === 'paid'}"
               ng-click="changeTab('paid', 1)">Đã thanh
                toán</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="pills-huy-tab" data-bs-toggle="pill" href="#pills-huy" role="tab"
               aria-controls="pills-false" aria-selected="false" ng-class="{active: currentTab === 'cancelled'}"
               ng-click="changeTab('cancelled', 2)">Hủy
                giao dịch</a>
        </li>
    </ul>
    <div class="card card-customer mb-4">
        <div class="row" style="margin: 20px 16px 20px 16px">
            <div class="col-xl-5">
                Bạn muốn tìm kiếm gì ?
                <div class="input-group mb-3">
                            <span class="input-group-text" id="basic-addon1"><i
                                    class="fa-solid fa-magnifying-glass bg-light"></i></span>
                    <input type="text" class="form-control" placeholder="Tìm kiếm" ng-model="searchTerm"
                           ng-change="searchBookingTour()"
                           aria-label="Username" aria-describedby="basic-addon1">
                </div>
            </div>
        </div>
    </div>

    <div class="table-components table-responsive mb-5" ng-show="currentTab === 'pending'">
        <div class="card table-responsive table-customer">
            <div class="card-header ">
                <div class="row">
                    <div class="h4 col-lg-5 d-flex align-items-center h-100">
                        <div class="d-flex align-items-center">
                            <span class="h4">Danh sách tour chờ thanh toán</span>
                        </div>
                    </div>
                    <div class="d-flex justify-content-end align-items-baseline col-lg-2">
                        <select class="form-select" aria-label="Default select example"
                                ng-model="pageSize"
                                ng-init="pageSize='5'"
                                ng-change="pageSizeChanged()">
                            <option value="5">5</option>
                            <option value="10">10</option>
                            <option value="15">15</option>
                        </select>
                    </div>
                    <div class="d-flex align-items-center justify-content-end h-100 col-lg-5">
                        <nav aria-label="Page navigation" ng-if="bookingTourList.length !== 0">
                            <ul class="pagination justify-content-center align-items-center">
                                <!-- Previous Page -->
                                <li class="page-item" ng-class="{disabled: currentPage === 0}">
                                    <a class="page-link" ng-click="setPage(0)">
                                        <i class="fa-solid fa-angles-left"></i>
                                    </a>
                                </li>

                                <!-- Ellipsis at the beginning -->
                                <li class="page-item" ng-if="currentPage > 2 && totalPages > 5">
                                    <span class="page-link">...</span>
                                </li>

                                <!-- Pagination Numbers -->
                                <li class="page-item cursor-pointer" ng-repeat="n in getPaginationRange()"
                                    ng-class="{active: n === currentPage}">
                                    <a class="page-link" ng-click="setPage(n)">{{ n + 1 }}</a>
                                </li>

                                <!-- Ellipsis at the end -->
                                <li class="page-item" ng-if="currentPage < totalPages - 3 && totalPages > 5">
                                    <span class="page-link">...</span>
                                </li>

                                <!-- Next Page -->
                                <li class="page-item" ng-class="{disabled: currentPage === totalPages - 1}">
                                    <a class="page-link" ng-click="setPage(totalPages - 1)">
                                        <i class="fa-solid fa-angles-right"></i>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
            <table class="table table-responsive text-center table-striped">
                <div ng-include="'app/component/utils/loading-table.html'"></div>
                <thead>
                <tr class="bg-light">
                    <th>#</th>
                    <th class="cursor-pointer" ng-click="sortData('id')">
                        <div class="icon-left">Mã đơn hàng
                            <span class="sorting-icon" ng-bind-html="getSortIcon('id')"></span>
                        </div>
                    </th>
                    <th class="cursor-pointer" ng-click="sortData('customerName')">
                        <div class="icon-left">Tên khách hàng
                            <span class="sorting-icon" ng-bind-html="getSortIcon('customerName')"></span>
                        </div>
                    </th>
                    <th class="cursor-pointer" ng-click="sortData('customerPhone')">
                        <div class="icon-left">SĐT khách hàng
                            <span class="sorting-icon" ng-bind-html="getSortIcon('customerPhone')"></span>
                        </div>
                    </th>
                    <th class="cursor-pointer" ng-click="sortData('orderTotal')">
                        <div class="icon-left">Giá
                            <span class="sorting-icon" ng-bind-html="getSortIcon('orderTotal        ')"></span>
                        </div>
                    </th>
                    <th class="cursor-pointer" ng-click="sortData('dateCreated')">
                        <div class="icon-left">Thời gian đặt tour
                            <span class="sorting-icon" ng-bind-html="getSortIcon('dateCreated')"></span>
                        </div>
                    </th>
                    <th class="cursor-pointer" ng-click="sortData('orderStatus')">
                        <div class="icon-left">Trạng thái
                            <span class="sorting-icon" ng-bind-html="getSortIcon('orderStatus')"></span>
                        </div>
                    </th>
                    <th>Thao tác</th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="btl in bookingTourList">
                    <td>{{ $index + 1 }}</td>
                    <td>{{ btl.id }}</td>
                    <td class="cursor-default">
                        <span custom-tooltip="{{ btl.customerName }}">
                            <span>{{ btl.customerName | limitTo: 15 }}</span>
                            <span ng-show="btl.customerName.length > 15">...</span>
                        </span>
                    </td>
                    <td>{{ btl.customerPhone | phoneNumber }}</td>
                    <td>{{ btl.orderTotal | vnCurrency }}</td>
                    <td>{{ btl.dateCreated | vietnameseDateTime }}</td>
                    <td ng-if="btl.orderStatus == 0">
                        <div class="d-flex align-items-center justify-content-center">
                            <span class="status-warning"></span>
                            <span class="text-status-warning">Chờ thanh toán</span>
                        </div>
                    </td>
                    <td ng-if="btl.orderStatus == 1">
                        <div class="d-flex align-items-center justify-content-center">
                            <span class="status-success"></span>
                            <span class="text-status-success">Đã thanh toán</span>
                        </div>
                    </td>
                    <td ng-if="btl.orderStatus == 2">
                        <div class="d-flex align-items-center justify-content-center">
                            <span class="status-error"></span>
                            <span class="text-status-error">Hủy giao dịch</span>
                        </div>
                    </td>
                    <td class="d-flex align-items-center justify-content-center">
                        <button class="fs-1 btn text-info px-2" ng-click="openModal(btl)">
                            <span custom-tooltip="Xem chi tiết"><i class="fa-regular fa-eye"></i></span>
                        </button>
                    </td>
                </tr>
                <tr ng-if="bookingTourList.length === 0">
                    <td colspan="14">Trang này không có dữ liệu.</td>
                </tr>
                </tbody>
            </table>
            <div class="card-footer">
                <div class="d-flex justify-content-end">
                    {{ getDisplayRange() }} trong tổng số {{ totalElements }}
                </div>
            </div>
        </div>
    </div>

    <div class="table-components table-responsive mb-5" ng-show="currentTab === 'paid'">
        <div class="card table-responsive table-customer">
            <div class="card-header ">
                <div class="row">
                    <div class="h4 col-lg-5 d-flex align-items-center h-100">
                        <div class="d-flex align-items-center">
                            <span class="h4">Danh sách tour đã thanh toán</span>
                        </div>
                    </div>
                    <div class="d-flex justify-content-end align-items-baseline col-lg-2">
                        <select class="form-select" aria-label="Default select example"
                                ng-model="pageSize"
                                ng-init="pageSize='5'"
                                ng-change="pageSizeChanged()">
                            <option value="5">5</option>
                            <option value="10">10</option>
                            <option value="15">15</option>
                        </select>
                    </div>
                    <div class="d-flex align-items-center justify-content-end h-100 col-lg-5">
                        <nav aria-label="Page navigation" ng-if="bookingTourList.length !== 0">
                            <ul class="pagination justify-content-center align-items-center">
                                <!-- Previous Page -->
                                <li class="page-item" ng-class="{disabled: currentPage === 0}">
                                    <a class="page-link" ng-click="setPage(0)">
                                        <i class="fa-solid fa-angles-left"></i>
                                    </a>
                                </li>

                                <!-- Ellipsis at the beginning -->
                                <li class="page-item" ng-if="currentPage > 2 && totalPages > 5">
                                    <span class="page-link">...</span>
                                </li>

                                <!-- Pagination Numbers -->
                                <li class="page-item cursor-pointer" ng-repeat="n in getPaginationRange()"
                                    ng-class="{active: n === currentPage}">
                                    <a class="page-link" ng-click="setPage(n)">{{ n + 1 }}</a>
                                </li>

                                <!-- Ellipsis at the end -->
                                <li class="page-item" ng-if="currentPage < totalPages - 3 && totalPages > 5">
                                    <span class="page-link">...</span>
                                </li>

                                <!-- Next Page -->
                                <li class="page-item" ng-class="{disabled: currentPage === totalPages - 1}">
                                    <a class="page-link" ng-click="setPage(totalPages - 1)">
                                        <i class="fa-solid fa-angles-right"></i>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
            <table class="table table-responsive text-center table-striped">
                <div ng-include="'app/component/utils/loading-table.html'"></div>
                <thead>
                <tr class="bg-light">
                    <th>#</th>
                    <th class="cursor-pointer" ng-click="sortData('id')">
                        <div class="icon-left">Mã đơn hàng
                            <span class="sorting-icon" ng-bind-html="getSortIcon('id')"></span>
                        </div>
                    </th>
                    <th class="cursor-pointer" ng-click="sortData('customerName')">
                        <div class="icon-left">Tên khách hàng
                            <span class="sorting-icon" ng-bind-html="getSortIcon('customerName')"></span>
                        </div>
                    </th>
                    <th class="cursor-pointer" ng-click="sortData('customerPhone')">
                        <div class="icon-left">SĐT khách hàng
                            <span class="sorting-icon" ng-bind-html="getSortIcon('customerPhone')"></span>
                        </div>
                    </th>
                    <th class="cursor-pointer" ng-click="sortData('orderTotal')">
                        <div class="icon-left">Giá
                            <span class="sorting-icon" ng-bind-html="getSortIcon('orderTotal        ')"></span>
                        </div>
                    </th>
                    <th class="cursor-pointer" ng-click="sortData('dateCreated')">
                        <div class="icon-left">Thời gian thanh toán
                            <span class="sorting-icon" ng-bind-html="getSortIcon('dateCreated')"></span>
                        </div>
                    </th>
                    <th class="cursor-pointer" ng-click="sortData('orderStatus')">
                        <div class="icon-left">Trạng thái
                            <span class="sorting-icon" ng-bind-html="getSortIcon('orderStatus')"></span>
                        </div>
                    </th>
                    <th>Thao tác</th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="btl in bookingTourList">
                    <td>{{ $index + 1 }}</td>
                    <td>{{ btl.id }}</td>
                    <td class="cursor-default">
                        <span custom-tooltip="{{ btl.customerName }}">
                            <span>{{ btl.customerName | limitTo: 15 }}</span>
                            <span ng-show="btl.customerName.length > 15">...</span>
                        </span>
                    </td>
                    <td>{{ btl.customerPhone | phoneNumber }}</td>
                    <td>{{ btl.orderTotal | vnCurrency }}</td>
                    <td>{{ btl.invoicesById[0].dateCreated | vietnameseDateTime }}</td>
                    <td ng-if="btl.orderStatus == 0">
                        <div class="d-flex align-items-center justify-content-center">
                            <span class="status-warning"></span>
                            <span class="text-status-warning">Chờ thanh toán</span>
                        </div>
                    </td>
                    <td ng-if="btl.orderStatus == 1">
                        <div class="d-flex align-items-center justify-content-center">
                            <span class="status-success"></span>
                            <span class="text-status-success">Đã thanh toán</span>
                        </div>
                    </td>
                    <td ng-if="btl.orderStatus == 2">
                        <div class="d-flex align-items-center justify-content-center">
                            <span class="status-error"></span>
                            <span class="text-status-error">Hủy giao dịch</span>
                        </div>
                    </td>
                    <td class="d-flex align-items-center justify-content-center">
                        <button class="fs-1 btn text-info px-2" ng-click="openModal(btl)">
                            <span custom-tooltip="Xem chi tiết"><i class="fa-regular fa-eye"></i></span>
                        </button>
                    </td>
                </tr>
                <tr ng-if="bookingTourList.length === 0">
                    <td colspan="14">Trang này không có dữ liệu.</td>
                </tr>
                </tbody>
            </table>
            <div class="card-footer">
                <div class="d-flex justify-content-end">
                    {{ getDisplayRange() }} trong tổng số {{ totalElements }}
                </div>
            </div>
        </div>
    </div>
    <div class="table-components table-responsive mb-5" ng-show="currentTab === 'cancelled'">
        <div class="card table-responsive table-customer">
            <div class="card-header ">
                <div class="row">
                    <div class="h4 col-lg-5 d-flex align-items-center h-100">
                        <div class="d-flex align-items-center">
                            <span class="h4">Danh sách tour huỷ giao dịch</span>
                        </div>
                    </div>
                    <div class="d-flex justify-content-end align-items-baseline col-lg-2">
                        <select class="form-select" aria-label="Default select example"
                                ng-model="pageSize"
                                ng-init="pageSize='5'"
                                ng-change="pageSizeChanged()">
                            <option value="5">5</option>
                            <option value="10">10</option>
                            <option value="15">15</option>
                        </select>
                    </div>
                    <div class="d-flex align-items-center justify-content-end h-100 col-lg-5">
                        <nav aria-label="Page navigation" ng-if="bookingTourList.length !== 0">
                            <ul class="pagination justify-content-center align-items-center">
                                <!-- Previous Page -->
                                <li class="page-item" ng-class="{disabled: currentPage === 0}">
                                    <a class="page-link" ng-click="setPage(0)">
                                        <i class="fa-solid fa-angles-left"></i>
                                    </a>
                                </li>

                                <!-- Ellipsis at the beginning -->
                                <li class="page-item" ng-if="currentPage > 2 && totalPages > 5">
                                    <span class="page-link">...</span>
                                </li>

                                <!-- Pagination Numbers -->
                                <li class="page-item cursor-pointer" ng-repeat="n in getPaginationRange()"
                                    ng-class="{active: n === currentPage}">
                                    <a class="page-link" ng-click="setPage(n)">{{ n + 1 }}</a>
                                </li>

                                <!-- Ellipsis at the end -->
                                <li class="page-item" ng-if="currentPage < totalPages - 3 && totalPages > 5">
                                    <span class="page-link">...</span>
                                </li>

                                <!-- Next Page -->
                                <li class="page-item" ng-class="{disabled: currentPage === totalPages - 1}">
                                    <a class="page-link" ng-click="setPage(totalPages - 1)">
                                        <i class="fa-solid fa-angles-right"></i>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
            <table class="table table-responsive text-center table-striped">
                <div ng-include="'app/component/utils/loading-table.html'"></div>
                <thead>
                <tr class="bg-light">
                    <th>#</th>
                    <th class="cursor-pointer" ng-click="sortData('id')">
                        <div class="icon-left">Mã đơn hàng
                            <span class="sorting-icon" ng-bind-html="getSortIcon('id')"></span>
                        </div>
                    </th>
                    <th class="cursor-pointer" ng-click="sortData('customerName')">
                        <div class="icon-left">Tên khách hàng
                            <span class="sorting-icon" ng-bind-html="getSortIcon('customerName')"></span>
                        </div>
                    </th>
                    <th class="cursor-pointer" ng-click="sortData('customerPhone')">
                        <div class="icon-left">SĐT khách hàng
                            <span class="sorting-icon" ng-bind-html="getSortIcon('customerPhone')"></span>
                        </div>
                    </th>
                    <th class="cursor-pointer" ng-click="sortData('orderTotal')">
                        <div class="icon-left">Giá
                            <span class="sorting-icon" ng-bind-html="getSortIcon('orderTotal        ')"></span>
                        </div>
                    </th>
                    <th class="cursor-pointer" ng-click="sortData('dateCreated')">
                        <div class="icon-left">Thời gian hủy đơn
                            <span class="sorting-icon" ng-bind-html="getSortIcon('dateCreated')"></span>
                        </div>
                    </th>
                    <th class="cursor-pointer" ng-click="sortData('orderStatus')">
                        <div class="icon-left">Trạng thái
                            <span class="sorting-icon" ng-bind-html="getSortIcon('orderStatus')"></span>
                        </div>
                    </th>
                    <th>Thao tác</th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="btl in bookingTourList">
                    <td>{{ $index + 1 }}</td>
                    <td>{{ btl.id }}</td>
                    <td class="cursor-default">
                        <span custom-tooltip="{{ btl.customerName }}">
                            <span>{{ btl.customerName | limitTo: 15 }}</span>
                            <span ng-show="btl.customerName.length > 15">...</span>
                        </span>
                    </td>
                    <td>{{ btl.customerPhone | phoneNumber }}</td>
                    <td>{{ btl.orderTotal | vnCurrency }}</td>
                    <td>{{ btl.dateCancelled | vietnameseDateTime }}</td>
                    <td ng-if="btl.orderStatus == 0">
                        <div class="d-flex align-items-center justify-content-center">
                            <span class="status-warning"></span>
                            <span class="text-status-warning">Chờ thanh toán</span>
                        </div>
                    </td>
                    <td ng-if="btl.orderStatus == 1">
                        <div class="d-flex align-items-center justify-content-center">
                            <span class="status-success"></span>
                            <span class="text-status-success">Đã thanh toán</span>
                        </div>
                    </td>
                    <td ng-if="btl.orderStatus == 2">
                        <div class="d-flex align-items-center justify-content-center">
                            <span class="status-error"></span>
                            <span class="text-status-error">Hủy giao dịch</span>
                        </div>
                    </td>
                    <td class="d-flex align-items-center justify-content-center">
                        <button class="fs-1 btn text-info px-2" ng-click="openModalCancelTransaction(btl)">
                            <span custom-tooltip="Xem chi tiết"><i class="fa-regular fa-eye"></i></span>
                        </button>
                    </td>
                </tr>
                <tr ng-if="bookingTourList.length === 0">
                    <td colspan="14">Trang này không có dữ liệu.</td>
                </tr>
                </tbody>
            </table>
            <div class="card-footer">
                <div class="d-flex justify-content-end">
                    {{ getDisplayRange() }} trong tổng số {{ totalElements }}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal xem thông tin tour đang chờ thanh toán và đã thanh toán -->
<div class="modal fade" id="modal-tour-detail" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header text-white">
                <h5 class="modal-title" id="exampleModalLabel">Chi tiết đặt tour {{ bookingTour.id }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12">
                            <div class="card mb-3">
                                <img class="img-fluid"
                                     src="{{bookingTour.toursByTourId.tourImg}}"
                                     onerror="this.src='/assets/admin/assets/img/bg/default-image-hotel.png'"
                                     style="height: 400px"/>
                                <div class="card-body">
                                    <div class="bg-header-model">
                                        <div class="h2 text-center fw-medium">
                                            {{ bookingTour.toursByTourId.tourName }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-5">
                            <div class="card mb-3">
                                <div class="card-header p-3 fw-bold">
                                    Thông tin tour
                                </div>
                                <div class="card-body p-3">
                                    <p class="m-2 fw-medium">Hướng dẫn viên: <span
                                            class="fw-normal">{{ bookingTour.usersByUserId.fullName }}</span></p>
                                    <p class="m-2 fw-medium">Mã Tour: <span
                                            class="fw-bold">{{ bookingTour.tourDetailsByTourDetailId.tourId }}</span>
                                    </p>
                                    <p class="m-2 fw-medium">Mã Tour chi tiết: <span
                                            class="fw-bold">{{ bookingTour.tourDetailId }}</span></p>
                                    <p class="m-2 fw-medium">Ngày đi: <span
                                            class="fw-medium color-warning">{{ bookingTour.tourDetailsByTourDetailId.departureDate | vietnameseDateTime }}</span>
                                    </p>
                                    <p class="m-2 fw-medium">Ngày về: <span
                                            class="fw-medium color-warning">{{ bookingTour.tourDetailsByTourDetailId.arrivalDate | vietnameseDateTime }}</span>
                                    </p>
                                    <p class="m-2 fw-medium">Điểm đi: <span
                                            class="fw-medium color-green">{{ bookingTour.tourDetailsByTourDetailId.fromLocation }}</span>
                                    </p>
                                    <p class="m-2 fw-medium">Điểm đến: <span
                                            class="fw-medium color-green">{{ bookingTour.tourDetailsByTourDetailId.toLocation }}</span>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-7">
                            <div class="card">
                                <div class="card-header p-3 fw-bold">
                                    Thông tin đặt tour
                                </div>
                                <div class="card-body p-3">
                                    <p class="m-2 fw-medium">Mã booking: <span
                                            class="fw-bold">{{ bookingTour.id }}</span></p>
                                    <p class="m-2 fw-medium">Email: <span
                                            class="fw-bold">{{ bookingTour.customerEmail }}</span></p>
                                    <p class="m-2 fw-medium">Tên khách hàng: <span
                                            class="fw-bold">{{ bookingTour.customerName }}</span></p>
                                    <p class="m-2 fw-medium">Số điện thoại: <span
                                            class="fw-bold">{{ bookingTour.customerPhone | phoneNumber }}</span></p>
                                    <p class="m-2 fw-medium">Tổng tiền: <span
                                            class="fw-bold">{{ bookingTour.orderTotal | vnCurrency }}</span></p>
                                    <p class="m-2 fw-medium">Ngày đặt tour: <span
                                            class="fw-bold text-warning">{{ bookingTour.dateCreated | vietnameseDateTime }}</span>
                                    </p>
                                    <p class="m-2 fw-medium" ng-if="bookingTour.orderStatus != 0">
                                        Thời gian thanh toán:
                                        <span class="fw-bold color-green">{{ bookingTour.invoicesById[0].dateCreated | vietnameseDateTime }}</span>
                                    </p>
                                    <p class="m-2 fw-medium">Trạng thái:
                                        <span class="fw-bold color-warning" ng-if="bookingTour.orderStatus == 0">
                                            Chờ thanh toán
                                        </span>
                                        <span class="fw-bold color-green" ng-if="bookingTour.orderStatus == 1">
                                            Đã thanh toán
                                        </span>
                                        <span class="fw-bold color-danger" ng-if="bookingTour.orderStatus == 2">
                                            Hủy giao dịch
                                        </span>
                                    </p>
                                    <p class="m-2 fw-medium">Ghi chú: <span
                                            class="fw-normal">{{ bookingTour.orderNote === null ? 'Không có thông tin ghi chú' : bookingTour.orderNote }}</span>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="col-12 col-lg-12 mt-2">
                            <table class="table table-bordered table-striped mb-1">
                                <thead>
                                <tr>
                                    <th class="fw-medium">STT</th>
                                    <th class="fw-medium">Loại vé</th>
                                    <th class="fw-medium">Số lượng</th>
                                    <th class="fw-medium">Đơn giá</th>
                                    <th class="fw-medium">Thành tiền</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr ng-if="bookingTour.capacityAdult > 0">
                                    <td>1</td>
                                    <td>
                                        <ul class="text-dark">
                                            Vé người lớn (trên 1m3)
                                        </ul>
                                    </td>
                                    <td>
                                        <ul class="text-dark">
                                            {{ bookingTour.capacityAdult + ' vé' }}
                                        </ul>
                                    </td>
                                    <td>
                                        <ul class="text-dark">
                                            {{ bookingTour.tourDetailsByTourDetailId.unitPrice | vnCurrency }}
                                        </ul>
                                    </td>
                                    <td>
                                        <span class="text-danger">
                                            {{ bookingTour.capacityAdult * bookingTour.tourDetailsByTourDetailId.unitPrice | vnCurrency }}
                                        </span>
                                    </td>
                                </tr>
                                <tr ng-if="bookingTour.capacityKid > 0">
                                    <td>2</td>
                                    <td>
                                        <ul class="text-dark">
                                            Vé trẻ em (dưới 1m3)
                                        </ul>
                                    </td>
                                    <td>
                                        <ul class="text-dark">
                                            {{ bookingTour.capacityKid + ' vé' }}
                                        </ul>
                                    </td>
                                    <td>
                                        <ul class="text-dark">
                                            {{ bookingTour.tourDetailsByTourDetailId.unitPrice * 0.3 | vnCurrency }}
                                        </ul>
                                    </td>
                                    <td>
                                        <span class="text-danger">
                                            {{ bookingTour.capacityKid * (bookingTour.tourDetailsByTourDetailId.unitPrice * 0.3) | vnCurrency }}
                                        </span>
                                    </td>
                                </tr>
                                </tbody>
                                <tfoot>
                                <tr>
                                    <td colspan="4">
                                        <li class="d-flex justify-content-end align-items-center">
                                            <div style="line-height: 20px">
                                                <strong>Tổng tiền:</strong>
                                                <strong>
                                                    <p class="mb-0" style="font-size: 13px">
                                                        (Đã bao gồm phí VAT)
                                                    </p>
                                                </strong>
                                            </div>
                                        </li>
                                    </td>
                                    <td>
                                        <span class="text-danger fw-medium">
                                            {{ bookingTour.orderTotal | vnCurrency }}
                                        </span>
                                    </td>
                                </tr>
                                </tfoot>
                            </table>
                        </div>

                        <div class="col-12 mt-3">
                            <div class="row">
                                <div class="col-xl-3 p-1"
                                     ng-repeat="img in bookingTour.tourDetailsByTourDetailId.tourDetailImagesById">
                                    <img class="img-fluid" style="height: 100%; width: 100%; border-radius: 8px"
                                         loading="lazy" ng-src="{{img.tourDetailImg}}" alt="img-tour"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">
                    <i class="fa-solid fa-arrow-left"></i>
                    Thoát
                </button>
                <button type="button"
                        class="btn btn-danger"
                        data-bs-toggle="modal"
                        data-bs-target="#cancelled_noted"
                >
                    Hủy tour
                </button>
                <button type="button"
                        ng-if="bookingTour.orderStatus == 1"
                        ng-click="printInvoice(bookingTour.invoicesById[0].id)"
                        class="btn btn-info"
                >
                    In hóa đơn
                    <i class="fa-solid fa-print"></i>
                </button>
                <button type="button" class="btn btn-success" data-dismiss="modal" ng-if="bookingTour.orderStatus == 0"
                        ng-click="browseBookingTour(bookingTour)">Thanh toán
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal xem thông tin đặt tour đã bị hủy -->
<div class="modal fade" id="modal-cancel-transaction" tabindex="-1" role="dialog"
     aria-labelledby="cancelTransactionModel"
     aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header text-white">
                <h5 class="modal-title" id="cancelTransactionModel">Chi tiết booking tour {{ bookingTour.id }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12">
                            <div class="card mb-3">
                                <img class="img-fluid"
                                     ng-src="{{bookingTour.toursByTourId.tourImg}}"
                                     onerror="this.src='/assets/admin/assets/img/bg/default-image-hotel.png'"
                                     style="height: 400px" alt="img-tour"/>
                                <div class="card-body">
                                    <div class="bg-header-model">
                                        <div class="h2 text-center fw-medium">
                                            {{ bookingTour.toursByTourId.tourName }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-5">
                            <div class="card mb-3">
                                <div class="card-header p-3 fw-bold">
                                    Thông tin tour
                                </div>
                                <div class="card-body p-3">
                                    <p class="m-2 fw-medium">Mã Tour: <span
                                            class="fw-bold">{{ bookingTour.tourDetailsByTourDetailId.tourId }}</span>
                                    </p>
                                    <p class="m-2 fw-medium">Mã Tour chi tiết: <span
                                            class="fw-bold">{{ bookingTour.tourDetailId }}</span></p>
                                    <p class="m-2 fw-medium">Hướng dẫn viên: <span
                                            class="fw-normal">{{ bookingTour.usersByUserId.fullName }}</span></p>
                                    <p class="m-2 fw-medium">Ngày đi: <span
                                            class="fw-medium color-warning">{{ bookingTour.tourDetailsByTourDetailId.departureDate | vietnameseDateTime }}</span>
                                    </p>
                                    <p class="m-2 fw-medium">Ngày về: <span
                                            class="fw-medium color-warning">{{ bookingTour.tourDetailsByTourDetailId.arrivalDate | vietnameseDateTime }}</span>
                                    </p>
                                    <p class="m-2 fw-medium">Điểm đi: <span
                                            class="fw-medium color-green">{{ bookingTour.tourDetailsByTourDetailId.fromLocation }}</span>
                                    </p>
                                    <p class="m-2 fw-medium">Điểm đến: <span
                                            class="fw-medium color-green">{{ bookingTour.tourDetailsByTourDetailId.toLocation }}</span>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-7">
                            <div class="card">
                                <div class="card-header p-3 fw-bold">
                                    Thông tin đặt tour
                                </div>
                                <div class="card-body p-3">
                                    <p class="m-2 fw-medium">Mã booking: <span
                                            class="fw-bold">{{ bookingTour.id }}</span></p>
                                    <p class="m-2 fw-medium">Email: <span
                                            class="fw-bold">{{ bookingTour.customerEmail }}</span></p>
                                    <p class="m-2 fw-medium">Tên khách hàng: <span
                                            class="fw-bold">{{ bookingTour.customerName }}</span></p>
                                    <p class="m-2 fw-medium">Số điện thoại: <span
                                            class="fw-bold">{{ bookingTour.customerPhone | phoneNumber }}</span></p>
                                    <p class="m-2 fw-medium">Tổng tiền: <span
                                            class="fw-bold">{{ bookingTour.orderTotal | vnCurrency }}</span></p>
                                    <p class="m-2 fw-medium">Ngày đặt tour: <span
                                            class="fw-bold color-green">{{ bookingTour.dateCreated | vietnameseDateTime }}</span>
                                    </p>
                                    <p class="m-2 fw-medium" ng-if="bookingTour.orderStatus == 2">
                                        Thời gian hủy đơn:
                                        <span class="fw-bold color-danger">{{ bookingTour.dateCancelled | vietnameseDateTime }}</span>
                                    </p>
                                    <p class="m-2 fw-medium">Trạng thái:
                                        <span class="fw-medium color-warning" ng-if="bookingTour.orderStatus == 0">
                                            Chờ thanh toán
                                        </span>
                                        <span class="fw-medium color-green" ng-if="bookingTour.orderStatus == 1">
                                            Đã thanh toán
                                        </span>
                                        <span class="fw-medium color-danger" ng-if="bookingTour.orderStatus == 2">
                                            Hủy giao dịch
                                        </span>
                                    </p>
                                    <p class="m-2 fw-medium">Ghi chú: <span
                                            class="fw-normal">{{ bookingTour.orderNote === null ? 'Không có thông tin ghi chú' : bookingTour.orderNote }}</span>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="col-12 col-lg-12 mt-3">
                            <table class="table table-bordered table-striped mb-1">
                                <thead>
                                <tr>
                                    <th class="fw-medium">STT</th>
                                    <th class="fw-medium">Loại vé</th>
                                    <th class="fw-medium">Số lượng</th>
                                    <th class="fw-medium">Đơn giá</th>
                                    <th class="fw-medium">Thành tiền</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr ng-if="bookingTour.capacityAdult > 0">
                                    <td>1</td>
                                    <td>
                                        <ul class="text-dark">
                                            Vé người lớn (trên 1m3)
                                        </ul>
                                    </td>
                                    <td>
                                        <ul class="text-dark">
                                            {{ bookingTour.capacityAdult + ' vé' }}
                                        </ul>
                                    </td>
                                    <td>
                                        <ul class="text-dark">
                                            {{ bookingTour.tourDetailsByTourDetailId.unitPrice | vnCurrency }}
                                        </ul>
                                    </td>
                                    <td>
                                        <span class="text-danger">
                                            {{ bookingTour.capacityAdult * bookingTour.tourDetailsByTourDetailId.unitPrice | vnCurrency }}
                                        </span>
                                    </td>
                                </tr>
                                <tr ng-if="bookingTour.capacityKid > 0">
                                    <td>2</td>
                                    <td>
                                        <ul class="text-dark">
                                            Vé trẻ em (dưới 1m3)
                                        </ul>
                                    </td>
                                    <td>
                                        <ul class="text-dark">
                                            {{ bookingTour.capacityKid + ' vé' }}
                                        </ul>
                                    </td>
                                    <td>
                                        <ul class="text-dark">
                                            {{ bookingTour.tourDetailsByTourDetailId.unitPrice * 0.3 | vnCurrency }}
                                        </ul>
                                    </td>
                                    <td>
                                        <span class="text-danger">
                                            {{ bookingTour.capacityKid * (bookingTour.tourDetailsByTourDetailId.unitPrice * 0.3) | vnCurrency }}
                                        </span>
                                    </td>
                                </tr>
                                </tbody>
                                <tfoot>
                                <tr>
                                    <td colspan="4">
                                        <li class="d-flex justify-content-end align-items-center">
                                            <div style="line-height: 20px">
                                                <strong>Tổng tiền:</strong>
                                                <strong>
                                                    <p class="mb-0" style="font-size: 13px">
                                                        (Đã bao gồm phí VAT)
                                                    </p>
                                                </strong>
                                            </div>
                                        </li>
                                    </td>
                                    <td>
                                        <span class="text-danger fw-medium">
                                            {{ bookingTour.orderTotal | vnCurrency }}
                                        </span>
                                    </td>
                                </tr>
                                </tfoot>
                            </table>
                        </div>

                        <div class="col-12 mt-3">
                            <div class="row">
                                <div class="col-xl-3 p-1"
                                     ng-repeat="img in bookingTour.tourDetailsByTourDetailId.tourDetailImagesById">
                                    <img class="img-fluid" style="height: 100%; width: 100%; border-radius: 8px"
                                         loading="lazy" ng-src="{{img.tourDetailImg}}" alt="img-tour"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">
                    <i class="fa-solid fa-arrow-left"></i>
                    Thoát
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal nhập thông tin tại sao ngưng hoạt động doanh nghiệp -->
<div class="modal fade" id="cancelled_noted" tabindex="-1" aria-labelledby="noted-agencies-label" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="noted-agencies-label">
                    Mô tả lí do
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" role="form" name="formCancelledTour">
                    <div class="form-group">
                        <label for="noted" class="form-label">
                            VUI LÒNG NHẬP LÍ DO HỦY TOUR VỚI KHÁCH HÀNG<span class="text-danger">*</span>
                        </label>
                        <textarea class="form-control"
                                  rows="4"
                                  id="noted"
                                  name="orderNoted"
                                  ng-model="bookingTourDto.orderNoted"
                                  ng-class="{ 'is-invalid': formCancelledTour.orderNoted.$invalid && formCancelledTour.orderNoted.$touched,
                                               'is-valid': formCancelledTour.orderNoted.$valid && formCancelledTour.orderNoted.$touched }"
                                  ng-pattern="/.{10,}/"
                                  placeholder="Nhập lí do hủy tour của khách hàng {{ bookingTour.customerName }} với số tiền {{ bookingTour.orderTotal | vnCurrency }}"
                                  required
                        ></textarea>
                        <small class="text-danger"
                               ng-show="formCancelledTour.orderNoted.$touched && formCancelledTour.orderNoted.$error.required">
                            Vui lòng nhập lí do vì sao hủy tour.
                        </small>
                        <small class="text-danger"
                               ng-show="formCancelledTour.orderNoted.$error.pattern">
                            Vui lòng nhập ít nhất 10 ký tự.
                        </small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button"
                        class="btn"
                        ng-click="hideModalCancelBookTour()"
                        data-bs-dismiss="modal"
                >
                    <i class="fa-solid fa-arrow-left"></i>
                    Quay về
                </button>
                <button type="button"
                        ng-disabled="formCancelledTour.$invalid"
                        ng-click="deleteBookingTour(bookingTour)"
                        class="btn btn-success"
                >
                    Xác nhận hủy
                </button>
            </div>
        </div>
    </div>
</div>